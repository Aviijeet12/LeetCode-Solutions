class Solution {
    public long maxBalancedSubsequenceSum(int[] nums) {
        int n = nums.length;
        long ms = Long.MIN_VALUE;
        int[] ind = new int[n];
        for(int i=0;i<n;i++){
            ind[i] = nums[i] - i;
        }
        TreeMap<Integer,Long> map = new TreeMap<>();
        for(int i=0;i<n;i++){
            if(nums[i]<=0){
                ms = Math.max(ms,nums[i]);
            }else{
                long currele = nums[i];
                if(map.floorKey(ind[i])!=null){
                    currele += map.get(map.floorKey(ind[i]));
                }
                while(map.ceilingKey(ind[i])!=null && map.get(map.ceilingKey(ind[i]))<currele){
                    map.remove(map.ceilingKey(ind[i]));
                }
                if(map.floorKey(ind[i])==null || map.get(map.floorKey(ind[i]))<currele){
                    map.put(ind[i], currele);
                }
                ms = Math.max(ms, currele);
            }
        }
        return ms;
    }
}
